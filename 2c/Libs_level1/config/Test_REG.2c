///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при первом открытии формы
Перем Спис,СписРазвернутых,Счет;

//___________________________________________________________________________________________
Процедура ВставитьУзел(Рег,Имя,Род)
	ТЭ=ДревоРГ.ВставитьЭлемент("+"+Имя,0,Род);
	Счет=Счет+1;
	Спис[Счет]=Рег;
	СписРазвернутых[Счет]=0;
	ДревоРГ.УстановитьДанные(ТЭ,Счет);
	
КонецПроцедуры


Процедура ПриОткрытии()
Корень=ДревоРГ.КорневойЭлемент();
ВставитьУзел(СоздатьОбъект("Реестр.HKLM"),"Машина",Корень);
ВставитьУзел(СоздатьОбъект("Реестр.HKCU"),"Юзер",Корень);
ВставитьУзел(СоздатьОбъект("Реестр.HKCR"),"Класс",Корень);

КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Предопределенная процедура - вызывается при закрытии формы
Процедура ПриЗакрытии()

КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Закрыть - выполняет закрытие формы
Процедура ЗакрытьФорму()
	Форма.Закрыть();
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Процедура обработки нажатия кнопки Выполнить
Процедура Выполнить()
	Рег=СоздатьОбъект("Реестр.HKLM","SOFTWARE\Microsoft\Windows NT\CurrentVersion");
	Система=Рег.ПолучитьЗначение("ProductName");
	СП=Рег.ПолучитьЗначение("CSDVersion");
	Вопрос("У вас: "+Система+" "+СП,"ОК");

КонецПроцедуры

//___________________________________________________________________________________________
Процедура ДобавитьСтроку(Имя,ЗН)
	ВЗ=ЗначенияРГ.КоличествоСтрок();
	ЗначенияРГ.ВставитьСтроку("",ВЗ);
	ЗначенияРГ.Текст(ВЗ,0,Имя);
	ЗначенияРГ.Текст(ВЗ,1,""+ЗН);
КонецПроцедуры



///////////////////////////////////////////////////////////////////////
//Обработка события объекта ДревоРГ
Процедура ПоказатьРГ()
	Перем СЧ;
	Элемент=ДревоРГ.ВыделенныйЭлемент();
	СЧ=ДревоРГ.ПолучитьДанные(Элемент,0);
	Пока ЗначенияРГ.КоличествоСтрок()>1 Цикл
		ЗначенияРГ.УдалитьСтроку(1);
	КонецЦикла;
	
	Рег=Спис[Сч];
	
	ЧЗнач=Рег.ВыбратьЗначения();
	Если ЧЗнач>0 Тогда
		ДобавитьСтроку("Есть ",""+ЧЗнач+" знач");
		Пока Рег.ПолучитьЗначение()=1 Цикл
			Если Рег.ИмяЗначения="" Тогда
			ДобавитьСтроку("(по-умолчанию)",Рег.Значение);
				Продолжить;
			КонецЕсли
			ДобавитьСтроку(Рег.ИмяЗначения,Рег.Значение);
		КонецЦикла;
		Иначе
		ДобавитьСтроку("Нифига нету","");
	КонецЕсли
	
	ЗначенияРГ.Обновить();
	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Обработка события объекта ДревоРГ
Процедура ОткрытьРГ()
	Перем СЧ;
	Элемент=ДревоРГ.ВыделенныйЭлемент();
	Сч=ДревоРГ.ПолучитьДанные(Элемент,0);
	Если СписРазвернутых[Сч]=1 Тогда
		Возврат;
	КонецЕсли
	
	РегРод=Спис[Сч];
	КвоКлючей=РегРод.ВыбратьКлючи();
	Пока РегРод.ПолучитьКлюч()=1 Цикл
		ВставитьУзел(РегРод.ключ,РегРод.Имяключа,Элемент);
	КонецЦикла;
	СписРазвернутых[Сч]=1;
	ТТ=ДревоРГ.ПолучитьТекст(Элемент);
	ДревоРГ.УстановитьТекст(Элемент,Сред(ТТ,2)+"  :"+КвоКлючей+" подключ");
	//ДревоРГ.Обновить();
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Обработка события объекта ИзмЗнач
Процедура ИзмЗнач()
	Рег=СоздатьОбъект("Реестр");
	Если Рег.Открыть("HKCU","software\2C\testRG")=0 Тогда
		Если Вопрос("Ключ не существует. Создать?","Да+Нет")="Да" Тогда
			Если Рег.СоздатьКлюч("HKCU","software\2C\testRG")=1 Тогда
				Вопрос("Ключ успешно создан!","Ок");
			Иначе
				Вопрос("Ключ НЕ создан!","Ок");
				Возврат;
			КонецЕсли
		Иначе
			Возврат;
		КонецЕсли
	КонецЕсли
	
	ЗН=Рег.Получить("Test2sReg"); //если нет - будет пустое значение!
	Если Рег.ЕстьЗначение("Test2sReg")=0 Тогда
		 Вопрос("Значения нету!","Ок");
	КонецЕсли
	Если ВвестиСтроку(ЗН,"Значение:",100)=1 Тогда
		Рег.Установить("Test2sReg",ЗН);
	КонецЕсли
	Возврат;
КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Обработка события объекта 
Процедура УдалитьКлюч()
	Рег=СоздатьОбъект("Реестр");
	Если Рег.Открыть("HKCU","software\2C")=0 Тогда
		Вопрос("Не могу открыть HKCU\software\2C");
		возврат;
	КонецЕсли;
	Если Рег.ЕстьПодключ("testRG")=0 Тогда
		Вопрос("Нет ключа testRG!");
		возврат;
	КонецЕсли
	
	Если Рег.УдалитьПодключ ("testRG")=0 Тогда
		Вопрос("НЕ могу удалить testRG!");
		возврат;
	Иначе
		Вопрос("testRG успешно удален!");
	КонецЕсли

КонецПроцедуры

///////////////////////////////////////////////////////////////////////
//Обработка события объекта 
Процедура УдалитьЗначение()
	Рег=СоздатьОбъект("Реестр");
	Если Рег.Открыть("HKCU","software\2C\testRG")=0 Тогда
		Вопрос("Ключ не существует!","Ок");
		Возврат;
	КонецЕсли
	Если Рег.ЕстьЗначение("Test2sReg")=0 Тогда
		Вопрос("Нет значения Test2sReg!");
		возврат;
	КонецЕсли
	Если Рег.УдалитьЗначение("Test2sReg")=0 Тогда
		Вопрос("НЕ могу удалить Test2sReg!");
		возврат;
	Иначе
		Вопрос("Test2sReg успешно удалено!");
	КонецЕсли

	

КонецПроцедуры

Спис=СоздатьОбъект("Массив");
СписРазвернутых=СоздатьОбъект("Массив");
Счет=0;