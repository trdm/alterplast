ѕерем м онт, мћас»мен, м–азмћас»мен;

///////////////////////////////////////////////////////////////////////
//¬ыполн€ет нечеткий поиск имени в массиве
‘ункци€ Ќайтиѕозицию»мени(п»м€)
	п—трѕоиск = Ћев(п»м€,1);
	
	//ѕолучение первой позиции блока элементов по первому символу	
	п»ндѕоиск1=0;
	ƒл€ п»нд=1 ѕо м–азмћас»мен ÷икл
		≈сли п—трѕоиск = Ћев(мћас»мен[п»нд],1) “огда
			п»ндѕоиск1 = п»нд;
			ѕрервать;
		 онец≈сли
	 онец÷икла
	≈сли п»ндѕоиск1=0 “огда
		¬озврат 0;
	 онец≈сли
	
	//ѕолучение последней позиции блока элементов по первому символу
	п»ндѕоиск2=0;
	ƒл€ п»нд=п»ндѕоиск1+1 ѕо м–азмћас»мен ÷икл
		≈сли п—трѕоиск <> Ћев(мћас»мен[п»нд],1) “огда
			п»ндѕоиск2 = п»нд-1;
			ѕрервать;
		 онец≈сли
	 онец÷икла
	≈сли п»ндѕоиск2=0 “огда
		п»ндѕоиск2 = м–азмћас»мен;
	 онец≈сли
	
	//ѕоиск внутри блока по максимальному совпадению имени
	пƒлина»м€ = —трƒлина(п»м€);
	пƒлинаѕоиск = 1;
	п»скома€ѕозици€ = п»ндѕоиск1;
	ƒл€ п»нд=п»ндѕоиск1 ѕо п»ндѕоиск2 ÷икл
		п“ек»м€ = мћас»мен[п»нд];
		пƒлина“ек»м€ = —трƒлина(п“ек»м€);
		
		≈сли пƒлина“ек»м€ < пƒлинаѕоиск “огда
			¬озврат п»скома€ѕозици€;
		 онец≈сли
		
		//—равниваем часть имени и при совпадении увеличиваем размер строки сравнени€ на 1 символ
		ѕока п—трѕоиск = Ћев(п“ек»м€, пƒлинаѕоиск) ÷икл
			≈сли пƒлинаѕоиск = пƒлина»м€ “огда
				¬озврат п»нд;
			»наче≈сли пƒлинаѕоиск = пƒлина“ек»м€ “огда
				ѕрервать;
			 онец≈сли
			
			пƒлинаѕоиск = пƒлинаѕоиск+1;
			п—трѕоиск = Ћев(п»м€, пƒлинаѕоиск);
			п»скома€ѕозици€ = п»нд;
		 онец÷икла
	 онец÷икла	
	
	¬озврат п»скома€ѕозици€;
 онец‘ункции

///////////////////////////////////////////////////////////////////////
//ѕредопределенна€ процедура - вызываетс€ при первом открытии формы
ѕроцедура ѕриќткрытии()
	пћас = ‘орма.ѕараметр;
	≈сли “ип«начени€—тр(пћас)<>"ћассив" “огда —татус¬озврата(0); ¬озврат;  онец≈сли
	
	м онт = пћас. онтекст;	
	рд—трокаѕоиска = пћас.—трокаѕоиска; //возможна€ строка начального элемента
	пћас = м онт.мћас»мен;

	//заполнение списков
	рд—пЁлементов.”далить¬се();
	ƒл€ п»нд=1 ѕо –азмер—труктуры(пћас) ÷икл
		рд—пЁлементов.ƒобавить«начение(пћас.«начениеѕоЌомеру(п»нд), пћас.»дентификаторѕоЌомеру(п»нд));
	 онец÷икла
	рд—пЁлементов.—ортироватьѕоѕредставлению();
	
	//ќбработка разных неполных написаний имени, начина€ от начала
	мћас»мен = —оздатьќбъект("ћассив");
	ƒл€ п»нд=1 ѕо рд—пЁлементов.–азмер—писка() ÷икл
		п»м€="";
		рд—пЁлементов.ѕолучить«начение(п»нд,п»м€);
		мћас»мен[п»нд] = ¬–ег(п»м€);
	 онец÷икла
	м–азмћас»мен = –азмерћассива(мћас»мен);

	‘орма.рд—трокаѕоиска.јктивизировать();	
	–едактирование—трокиѕоиска();
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
ѕроцедура ¬ыборЁлемента()
	пћас = рд—пЁлементов.ѕолучить«начение(рд—пЁлементов.“екуща€—трока());
	
	≈сли “ип«начени€—тр(пћас)="ћассив" “огда
		рд—п¬хождений.”далить¬се();
		ƒл€ п»нд=1 ѕо –азмер—труктуры(пћас) ÷икл
			рд—п¬хождений.ƒобавить«начение(пћас.«начениеѕоЌомеру(п»нд), пћас.»дентификаторѕоЌомеру(п»нд));
		 онец÷икла
	 онец≈сли
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
ѕроцедура ¬ыбор¬хождени€()
	≈сли рд—п¬хождений.“екуща€—трока()>0 “огда
		м онт.ƒерево.¬ыделенныйЁлемент(рд—п¬хождений.ѕолучить«начение(рд—п¬хождений.“екуща€—трока()));
	 онец≈сли
	‘орма.«акрыть();
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
ѕроцедура Ќажатие лавиши()
	≈сли Ќажата€ лавиша()=13 “огда
		¬ыбор¬хождени€();	
	 онец≈сли
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
//ѕроцедура обработки нажати€ кнопки ќ 
ѕроцедура  нопка_ќ ()
	¬ыбор¬хождени€();
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
//ѕроцедура обработки нажати€ кнопки ќтмена
ѕроцедура  нопка_ќтмена()
	‘орма.«акрыть();
 онецѕроцедуры

///////////////////////////////////////////////////////////////////////
ѕроцедура –едактирование—трокиѕоиска()
	п—тр = ¬–ег(рд—трокаѕоиска);
	≈сли ѕуста€—трока(п—тр)=0 “огда
		пѕоз = Ќайтиѕозицию»мени(п—тр)
		≈сли пѕоз>0 “огда
			рд—пЁлементов.“екуща€—трока(пѕоз);
			¬ыборЁлемента();
			рд—трокаѕоиска.јктивизировать();
		 онец≈сли
	 онец≈сли
 онецѕроцедуры